---
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceDefaults
metadata:
  name: web
spec:
  protocol: http

---
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceDefaults
metadata:
  name: api
spec:
  protocol: http

---
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceResolver
metadata:
  name: api
spec:
  defaultSubset: v1
  subsets:
    v1:
      filter: "Service.Meta.version == v1"
      onlyPassing: true
    v2:
      filter: "Service.Meta.version == v2"
      onlyPassing: true

#---
#apiVersion: consul.hashicorp.com/v1alpha1
#kind: ServiceSplitter
#metadata:
#  name: api
#spec:
#  splits:
#    - weight: 70
#      service: api
#      serviceSubset: v1
#    - weight: 30
#      service: api
#      serviceSubset: v2
